/*! Backbone 2016-10-13 */
var com=com||{};com.apress=com.apress||{},com.apress.model=com.apress.model||{},com.apress.model.Profile=Backbone.Model.extend({urlRoot:"http://localhost:8080/profile",parse:function(a){return a}});var com=com||{};com.apress=com.apress||{},com.apress.model=com.apress.model||{},com.apress.model.Search=Backbone.Model.extend({urlRoot:"http://localhost:8080/search",url:"http://localhost:8080/search",sync:function(a,b,c){this.url=this.urlRoot,this.get("query")&&(this.url=this.url+"/"+this.get("query")),Backbone.sync.call(this,a,b,c)}});var com=com||{};com.apress=com.apress||{},com.apress.model=com.apress.model||{},com.apress.model.Tweet=Backbone.Model.extend({parse:function(a){var b=moment(a.created_at,"ddd MMM DD HH:mm:ss ZZ YYYY").fromNow();return a.friendlyDate=b,a}});var com=com||{};com.apress=com.apress||{},com.apress.collection=com.apress.collection||{},com.apress.collection.Timeline=Backbone.Collection.extend({model:com.apress.model.Tweet,url:"http://localhost:8080/timeline",initialize:function(a){}});var com=com||{};com.apress=com.apress||{},com.apress.view=com.apress.view||{},com.apress.view.ProfilePopupView=Backbone.View.extend({template:Handlebars.compile($("#profile-template").html()),model:null,initialize:function(a){var b=this;b.model=new com.apress.model.Profile({id:a.user}),b.model.fetch({}),b.listenTo(b.model,"change",b.render)},render:function(){var a=this;return a.model.get("screen_name")&&($("#profile-dialog").on("show.bs.modal",function(b){var c=$(this);c.find(".modal-title").text("@"+a.model.get("screen_name")+"s Profile"),c.find(".modal-body .modal-name").text(a.model.get("name")),c.find(".modal-body .modal-descr").text(a.model.get("description")),c.find(".modal-body .modal-followers").text(a.model.get("followers_count")+" Followers")}),$("#profile-dialog").modal("show")),a}});var com=com||{};com.apress=com.apress||{},com.apress.view=com.apress.view||{},com.apress.view.ProfileView=Backbone.View.extend({el:"#profile",template:Handlebars.compile($("#profile-template").html()),initialize:function(a){},render:function(){var a=this,b=a.template({user:a.model.toJSON()});return a.$el.html(b),a}});var com=com||{};com.apress=com.apress||{},com.apress.view=com.apress.view||{},com.apress.view.ResultsView=Backbone.View.extend({el:"#results",model:null,template:Handlebars.compile($("#timeline-template").html()),initialize:function(a){var b=this;b.model=a.model,b.model.fetch(),b.listenTo(b.model,"change",b.render)},render:function(){var a=this,b=a.template({tweet:a.model.get("statuses")});$("#search-dialog").on("show.bs.modal",function(a){var c=$(this);c.find(".modal-body").empty(),c.find(".modal-body").append(b)}),$("#search-dialog").modal("show")}});var com=com||{};com.apress=com.apress||{},com.apress.view=com.apress.view||{},com.apress.view.SearchView=Backbone.View.extend({el:"#search",model:null,events:{"click #searchbutton":"runSearch"},initialize:function(a){var b=this;b.model=a.model},runSearch:function(a){var b=this;query=$("#searchbox").val(),a.preventDefault(),console.log("Run search against "+query),b.model.set("query","",{silent:!0}),b.model.set("query",query)}});var com=com||{};com.apress=com.apress||{},com.apress.view=com.apress.view||{},com.apress.view.TimelineView=Backbone.View.extend({el:"#timeline",template:Handlebars.compile($("#timeline-template").html()),events:{"click .profile":"showDialog"},initialize:function(a){},render:function(){var a=this;if(a.model.length>0){var b=a.template({tweet:a.model.toJSON()});a.$el.append(b)}return a},showDialog:function(a){var b=$(a.currentTarget),c=b.data("user");new com.apress.view.ProfilePopupView({user:c})}});var com=com||{};com.apress=com.apress||{},com.apress.router=com.apress.router||{},com.apress.router.AppRouter=Backbone.Router.extend({searchModel:null,initialize:function(a){var b=this;b.searchModel=a.searchModel,b.listenTo(b.searchModel,"change:query",b.navigateToSearch)},navigateToSearch:function(a,b){this.navigate("search/"+a.get("query"),{trigger:!0})},routes:{"search/:query":"search"},search:function(a){var b=this;console.log("search for "+a),b.searchModel.get("query")!==a&&b.searchModel.set("query",a,{silent:!0}),b.searchModel.fetch({success:function(a){new com.apress.view.ResultsView({model:a.clone()})},error:function(a){alert("No results available")}})}}),$(function(){Handlebars.registerHelper("format",function(a){return a?(a=a.replace(/[@]+[A-Za-z0-9-_]+/g,function(a){var b=a.replace("@","");return'<a href="#" data-user="'+b+'"class="profile">@'+b+"</a>"}),new Handlebars.SafeString(a)):a})}),$(function(){var a=new com.apress.collection.Timeline,b=new com.apress.view.TimelineView({model:a});b.render(),a.fetch({reset:!0}),b.listenTo(a,"reset",b.render);var c=new com.apress.model.Profile,d=new com.apress.view.ProfileView({model:c});c.fetch(),d.listenTo(c,"change",d.render),searchModel=new com.apress.model.Search,searchView=new com.apress.view.SearchView({model:searchModel}),appRouter=new com.apress.router.AppRouter({searchModel:searchModel}),Backbone.history.start()});